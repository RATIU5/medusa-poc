---
import {medusa} from "../../lib/medusa";

export const prerender = false;

const { categorySlug } = Astro.params;

if (!categorySlug) {
  return new Response("Not Found", { status: 404 });
}

const categoryList = await medusa.productCategories.list({handle: categorySlug});

if (categoryList.product_categories.length === 0) {
  return new Response("Not Found", { status: 404 });
}

if (categoryList.product_categories.length > 1) {
  return new Response("Multiple categories found", { status: 404 });
}

const category = categoryList.product_categories[0];

const prodRes = await medusa.products.list({
  category_id: [category?.id ?? ""],
  limit: 10,
});

---

<h1>{category?.name}</h1>
<p>{category?.description}</p>

<ul>
{prodRes.products.map((product) => (
  <li>
    <a href={`/product/${product.handle}`}>{product.title}</a>
  </li>
))}
</ul>